% !TeX spellcheck = <none>

%\newcommand{\compileall}{def}


\documentclass[amstex,twoside]{ctexbook}


\usepackage{marginnote}

% 16开本
\usepackage[
		paperwidth=195mm,
		paperheight=271mm,
		%装订线宽10mm,页边距 28mm
		inner = 38mm,
		outer = 28mm,
		tmargin = 36mm,
		bmargin = 30mm,
		marginparwidth=2cm
	]{geometry}

\usepackage{needspace}
\usepackage{wrapfig}
\usepackage{float}
\usepackage[below,section]{placeins}
\usepackage{color}
\usepackage{tabularx}
\usepackage{longtable}
\usepackage{multirow}
\usepackage{rotating}
\usepackage{soul}
\usepackage{amsmath}
\usepackage{wasysym}
\usepackage{amsthm}
\usepackage{stmaryrd}
\usepackage{xltxtra}
% always load hyperref as last packages
\usepackage[colorlinks,linkcolor=black]{hyperref}
%\usepackage{todonotes}


%\input{draftcopy}

%=====================================================================================
% font setting
%=====================================================================================
\input{setfonts}

%=====================================================================================
% define new command and environment 
%=====================================================================================
\renewcommand*{\marginfont}{\color{red}\scriptsize}
\newcommand*{\todo}[1]{\marginnote[%
\color{blue}\footnotesize%
TODO:#1%
]{%
\color{blue}\footnotesize%
TODO:#1}
}

\definecolor{gray}{cmyk}{0,0,0,0.2}

%=====================================================================================
% define new command and environment 
%=====================================================================================
\newenvironment{notice}{\tt}{}
\newenvironment{insertnote}{ \ttfamily\CJKfamily{KaiTi} }{\vskip 0.5cm }
\newenvironment{code}{\small\tt\begin{longtable}{p{0.8\textwidth}}}{\end{longtable}}

\newcommand{\email}[1]{\href{mailto:#1}{#1}}

\newcommand{\RTLpar}{% right-to-left paragraph alignment
  \leftskip=0pt plus .5fil%
  \rightskip=0pt plus -.5fil%
  \parfillskip=0pt plus .5fil%
}

\newenvironment{quotes}[2][0.55]{\pushQED{#2}%
\begin{flushright}%
\begin{minipage}{#1\textwidth}\begin{flushright}\noindent\it\RTLpar}{%
 \\------\popQED{}\end{flushright}\end{minipage}\end{flushright}\vskip 8mm }%

\newenvironment{filecontent}[1]{

\addtolength{\linewidth}{-\parindent}
\begin{minipage}{\linewidth}

\vskip 1ex

文件: #1

\vskip -2ex
\rule{\textwidth}{0.02pt}
\vskip -1ex

%\hline

}{	\end{minipage}}




\newcounter{lizi}[chapter]

\newenvironment{example}[1]{ \addtocounter{lizi}{1} \vskip 2.5ex \bf 例\hskip -0.05em\arabic{chapter}.\arabic{lizi}： #1%
\par %
 \tt\small\CJKfamily{zhfs}}{ \vskip 2.5ex  }

\newcommand{\theexample}{\arabic{chapter}.\arabic{lizi}}

\makeatletter\newcommand{\chatu}{\@ifstar%
                     \chatuStar%
                     \chatuNoStar%
}\makeatother

\newcommand{\chatuNoStar}[3][scale=0.35]{%
\begin{figure}[htbp]%
\noindent\centering%
\includegraphics[#1]{pics/#2}%
\caption{#3\label{fig:#2}}%
\end{figure}%
}


\newcommand{\chatuStar}[3][scale=0.35]{%
\begin{figure*}[H]%
\noindent\centering%
\includegraphics[#1]{pics/#2}%
\label{fig:#2}%
\end{figure*}%
}


\newcommand{\faqref}[1]{~附录 \ref{chap:FAQ}.\nameref{chap:FAQ}~“\nameref{#1}”}
\newcommand{\secref}[1]{ { \it节\ref{#1}~\nameref{#1}} }

\newcommand{\chapref}[1]{ { \it第\ref{#1}章~\nameref{#1}} }


\newcounter{faqs}

\makeatletter
\newcommand\@publisher{}
\newcommand{\publisher}[1]{
\renewcommand\@publisher{#1}
}

\newcommand\@company{}
\newcommand{\company}[1]{
\renewcommand\@company{#1}
}
\makeatother


%=====================================================================================
% style settings
%=====================================================================================

% 阿拉伯数字章节
\setcounter{chapter}{-1}
\CTEXsetup[number={\arabic{chapter}}]{chapter}
% 对齐设置
\tolerance=4500
\punctstyle{hangmobanjiao}
\CJKecglue{}
\CJKsetecglue{} %{\hskip 0.1em plus 0.05em minus 0.05em}

%=====================================================================================
% book info
\input{bookinfo}
%=====================================================================================


\begin{document}

%=========================================================
% 首页
%=========================================================
{
\include{coverpage}

%TODO 发行的时候解除这个
%\include{copyrightnote}

\include{thanks}
}

%=========================================================
%目录
%=========================================================
\tableofcontents

%=========================================================
% 序言
%=========================================================
\chapter{序}
\begin{quotes}{George Santayana}
Those who cannot remember the past are condemned to repeat it.
\end{quotes}

\ifdefined\compileall
\input{preface}
\fi


%=========================================================
% 正文开始
%=========================================================
\chapter{UNIX哲学}
\begin{quotes}{Dennis Ritchie}
UNIX is very simple, it just needs a genius to understand its simplicity.
\end{quotes}

\ifdefined\compileall
\input{chp_unix}
\fi

\chapter{黑客和Linux}
\begin{quotes}{Linus Benedict Torvalds}
If 386-BSD had been available when I started on Linux, Linux would probably never had happened.
\end{quotes}
\ifdefined\compileall
\input{chp_hackerandlinux}
\fi

\chapter{初识Linux}

\begin{quotes}[0.63]{The Gospel of Tux}
Now may you code in the power of the Source; may the Kernel, the Libraries and the Utilities be with you, throughout all Distributions, until the end of the Epoch. Amen. 
\end{quotes}

\ifdefined\compileall
\input{linuxintro}\fi

\chapter{安装 Linux}

\begin{quotes}[0.5]{insomnia}
It only takes three commands to install Gentoo!
\end{quotes}

\begin{quotes}{Anonymous}
“Where there is a shell，there is a way!”
\end{quotes}

\ifdefined\compileall
\input{install}\fi

\chapter{Linux的日常}

\begin{quotes}[0.52]{Jef Raskin}
A computer shall not waste your time or require you to do more work than is strictly necessary.
\end{quotes}

\ifdefined\compileall
\input{dialy}\fi



\ifdefined\compileall
\include{pkgmgr}
\else
\addtocounter{chapter}{1}
\fi

\chapter{图形界面}

\begin{quotes}{Steven Paul Jobs}
We made the buttons on the screen look so good you'll want to lick them.
\end{quotes}

\ifdefined\compileall
\input{gui}\fi

\chapter{网络}\label{chap:network}

\begin{quotes}[0.5]{Bill Gates}
I see little commercial potential for the Internet for at least 10 years
\end{quotes}

%\ifdefined\compileall
\input{network} %\fi

\chapter{文件系统}

\begin{quotes}{Ken Thompson}
We have persistant objects, they're called files.
\end{quotes}

\section{磁盘上的文件系统	}
\subsection{块设备和磁盘}
\subsection{超级块和inode}
\subsection{典型磁盘文件系统举例}
\section{虚拟文件系统}
\subsection{/proc内核信息窗口}
\subsection{/dev设备文件系统和udev}
\subsection{虚拟内存盘tmpfs}
\section{网络文件系统	}
\subsection{NFS}
\subsection{Windows 网络邻居 CIFS}
\section{  其他的文件系统	}
\subsection{  LiveCD的最爱——压缩文件系统squashfs}
\subsection{  为Flash芯片设计的文件系统}

\chapter{架设服务器}
\section{  搭建 HTTP 服务器}
\subsection{  apache 用的最多的服务器}
\subsection{ nginx 轻量级服务器}
\subsection{ lighttpd 超轻量级服务器}
\subsection{ squid 加速代理	}
\section{  数据库	}
\subsection{  最流行的开源数据库 MySQL}
\subsection{  最优秀的开源数据库 PostgreSQL 	}
\subsection{  商业霸主 OracleDB	}
\section{  加速 DNS ，在本机搭建 DNS	}
\section{  共享打印机	}
\subsection{ CUPS 打印服务	}
\subsection{ Samba 打印机共享	}

\ifdefined\compileall
\include{optimize}
\else
\addtocounter{chapter}{1}
\fi


\chapter{时光机器-版本控制系统}\label{chap:VCS}
\section{   历史和后悔药	}
\section{   中心式版本控制仓库 CVS	}
\section{   CVS 后继 SVN	}
\section{GIT 划时代的分布式版本控制\label{sec:git}}
\subsection{  Bitkeeper	}
\subsection{  Linus 消失的一周	}
\subsection{  版本控制设计为一个文件系统	}
\subsection{ 去中心化	}
\subsection{  GIT典型工作流	}
\subsection{  GIT 简单使用	}


\appendix

{ \include{faq} }

%{ \include{wars} }

{ \include{manpage} }


\chapter{名称缩写}

\chapter{图片索引}
%\cleardoublepage
{
\renewcommand{\cleardoublepage}{}

\renewcommand\listfigurename{}
\vskip -3cm
%\addtocounter{chapter}{1}
%\addcontentsline{toc}{chapter}{图片索引}
\listoffigures 
%\cleardoublepage
}


\ifdefined\compileall
\include{app_gentoolife}
\else
\addtocounter{chapter}{1}
\fi

\end{document}
